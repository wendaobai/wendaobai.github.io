import{_ as s,c as l,o as a,e as n}from"./app.0c9f1ae8.js";const e="/assets/image-20230314102457605.9326583b.png",t="/assets/image-20230314102615256.22656ba3.png",o="/assets/image-20230315143429170.10852ca8.png",u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[{"level":2,"title":"什么是docker","slug":"什么是docker","link":"#什么是docker","children":[]},{"level":2,"title":"docker和KVM","slug":"docker和kvm","link":"#docker和kvm","children":[]},{"level":2,"title":"docker架构","slug":"docker架构","link":"#docker架构","children":[]},{"level":2,"title":"docker安装","slug":"docker安装","link":"#docker安装","children":[{"level":3,"title":"启动","slug":"启动","link":"#启动","children":[]}]},{"level":2,"title":"镜像image","slug":"镜像image","link":"#镜像image","children":[{"level":3,"title":"image的相关指令","slug":"image的相关指令","link":"#image的相关指令","children":[]}]},{"level":2,"title":"容器container","slug":"容器container","link":"#容器container","children":[{"level":3,"title":"container 命令","slug":"container-命令","link":"#container-命令","children":[]},{"level":3,"title":"启动容器","slug":"启动容器","link":"#启动容器","children":[]},{"level":3,"title":"容器制作个性化image","slug":"容器制作个性化image","link":"#容器制作个性化image","children":[]}]},{"level":2,"title":"Dockerfile文件","slug":"dockerfile文件","link":"#dockerfile文件","children":[{"level":3,"title":"指令","slug":"指令","link":"#指令","children":[]},{"level":3,"title":".dockerignore 表示要排除，不要打包到image中的文件路径","slug":"dockerignore-表示要排除-不要打包到image中的文件路径","link":"#dockerignore-表示要排除-不要打包到image中的文件路径","children":[]}]},{"level":2,"title":"数据卷volume","slug":"数据卷volume","link":"#数据卷volume","children":[]},{"level":2,"title":"网络设置","slug":"网络设置","link":"#网络设置","children":[]},{"level":2,"title":"compose","slug":"compose","link":"#compose","children":[{"level":3,"title":"启动命令","slug":"启动命令","link":"#启动命令","children":[]},{"level":3,"title":"compose 配置数据卷volume","slug":"compose-配置数据卷volume","link":"#compose-配置数据卷volume","children":[]}]},{"level":2,"title":"docker compose 搭建node项目","slug":"docker-compose-搭建node项目","link":"#docker-compose-搭建node项目","children":[]}],"relativePath":"前端运维/Linux/docker.md"}'),p={name:"前端运维/Linux/docker.md"},c=n('<p>docker</p><h2 id="什么是docker" tabindex="-1">什么是docker <a class="header-anchor" href="#什么是docker" aria-hidden="true">#</a></h2><ul><li><p>软件部署的问题：如果要让软件运行起来，就必须保证操作系统设置环境，保证各自库与组件都能安装运行</p></li><li><p>虚拟机就是带环境安装的解决方案，它可以在一种操作系统中运行另一种操作系统</p><p>问题：</p><ul><li>资源占用多</li><li>冗余步骤多</li><li>启动速度慢</li></ul></li><li><p>Linux容器化</p><p>由于虚拟机存在这些缺点，Linux 发展出了另一种虚拟化技术：Linux 容器（Linux Containers，缩写为 LXC）。</p><p>Linux 容器不是模拟一个完整的操作系统，而是对进程进行隔离。或者说，在正常进程的外面套了一个保护层。对于容器里面的进程来说，它接触到的各种资源都是虚拟的，从而实现与底层系统的隔离。</p><ul><li>启动快</li><li>资源占用少</li><li>体积小</li></ul></li><li><p>Docker 属于 Linux 容器的一种封装，提供简单易用的容器使用接口。它是目前最流行的 Linux 容器解决方案</p></li><li><p>Docker 将应用程序与该程序的依赖，打包在一个文件里面。运行这个文件，就会生成一个虚拟容器。程序在这个虚拟容器里运行，就好像在真实的物理机上运行一样</p></li></ul><h2 id="docker和kvm" tabindex="-1">docker和KVM <a class="header-anchor" href="#docker和kvm" aria-hidden="true">#</a></h2><p>docker是虚拟一个微服务所需要的环境容器，kvm是硬件虚拟化，虚拟一个操作系统</p><ul><li>启动时间 <ul><li>Docker秒级启动</li><li>KVM分钟级启动</li></ul></li><li>轻量级 容器镜像通常以M为单位，虚拟机以G为单位，容器资源占用小，要比虚拟要部署更快速 <ul><li>容器共享宿主机内核，系统级虚拟化，占用资源少，容器性能基本接近物理机</li><li>虚拟机需要虚拟化一些设备，具有完整的OS,虚拟机开销大，因而降低性能，没有容器性能好</li></ul></li><li>安全性 <ul><li>由于共享宿主机内核，只是进程隔离，因此隔离性和稳定性不如虚拟机，容器具有一定权限访问宿主机内核，存在一下安全隐患</li></ul></li><li>使用要求 <ul><li>KVM基于硬件的完全虚拟化，需要硬件CPU虚拟化技术支持</li><li>容器共享宿主机内核，可运行在主机的Linux的发行版，不用考虑CPU是否支持虚拟化技术</li></ul></li></ul><h2 id="docker架构" tabindex="-1">docker架构 <a class="header-anchor" href="#docker架构" aria-hidden="true">#</a></h2><img src="'+e+'" alt="image-20230314102457605" style="zoom:50%;"><ul><li>containerd 是一个守护进程，使用runc管理容器，向Docker Engine提供接口</li><li>shim 只负责管理一个容器</li><li>runC是一个轻量级工具，只用来运行容器</li></ul><img src="'+t+`" alt="image-20230314102615256" style="zoom:67%;"><p><code>Docker</code> 在运行时分为 <code>Docker 引擎（服务端守护进程）</code> 和 <code>客户端工具</code>，我们日常使用各种 <code>docker 命令</code>，其实就是在使用 <code>客户端工具</code> 与 <code>Docker 引擎</code> 进行交互。还有一个docker镜像仓库</p><h2 id="docker安装" tabindex="-1">docker安装 <a class="header-anchor" href="#docker安装" aria-hidden="true">#</a></h2><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum-utils</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">device-mapper-persistent-data</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">lvm2</span></span>
<span class="line"><span style="color:#FFCB6B;">yum-config-manager</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">--add-repo</span><span style="color:#A6ACCD;">     </span><span style="color:#C3E88D;">https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce-cli</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerd.io</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"></span></code></pre></div><h3 id="启动" tabindex="-1">启动 <a class="header-anchor" href="#启动" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># </span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vesion</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">info</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">remove</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 卸载docker</span></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/lib/docker</span></span>
<span class="line"></span></code></pre></div><h2 id="镜像image" tabindex="-1">镜像image <a class="header-anchor" href="#镜像image" aria-hidden="true">#</a></h2><ul><li>Docker将运用程序和依赖包打包在Image中，只有通过image才能生成docker容器</li><li>image可以看成docker容器的模板,类似class,容器就是实例</li><li>Docker 根据 image 文件生成容器的实例</li><li>同一个 image 文件，可以生成多个同时运行的容器实例</li><li>镜像不是一个单一的文件，而是有多层，类似运输车的集装箱的堆集</li><li>容器其实就是在镜像的最上面加了一层读写层，在运行容器里做的任何文件改动，都会写到这个读写层里。如果容器删除了，最上面的读写层也就删除了，改动也就丢失了</li><li>我们可以通过<code>docker history &lt;ID/NAME&gt;</code> 查看镜像中各层内容及大小，每层对应着<code>Dockerfile</code>中的一条指令</li></ul><h3 id="image的相关指令" tabindex="-1">image的相关指令 <a class="header-anchor" href="#image的相关指令" aria-hidden="true">#</a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">含义</th><th style="text-align:left;">语法</th><th style="text-align:left;">案例</th></tr></thead><tbody><tr><td style="text-align:left;">ls</td><td style="text-align:left;">查看全部镜像</td><td style="text-align:left;">docker image ls</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">search</td><td style="text-align:left;">查找镜像</td><td style="text-align:left;">docker search [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">history</td><td style="text-align:left;">查看镜像历史</td><td style="text-align:left;">docker history [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">inspect</td><td style="text-align:left;">显示一个或多个镜像详细信息</td><td style="text-align:left;">docker inspect [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">pull</td><td style="text-align:left;">拉取镜像</td><td style="text-align:left;">docker pull [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">push</td><td style="text-align:left;">推送一个镜像到镜像仓库</td><td style="text-align:left;">docker push [imageName]</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">rmi</td><td style="text-align:left;">删除镜像</td><td style="text-align:left;">docker rmi [imageName] docker image rmi 2</td><td style="text-align:left;"></td></tr><tr><td style="text-align:left;">prune</td><td style="text-align:left;">移除未使用的镜像，没有标记或补任何容器引用</td><td style="text-align:left;">docker image prune</td><td style="text-align:left;">docker image prune</td></tr><tr><td style="text-align:left;">tag</td><td style="text-align:left;">标记本地镜像，将其归入某一仓库</td><td style="text-align:left;">docker tag [OPTIONS] IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]</td><td style="text-align:left;">docker tag centos:7 zhangrenyang/centos:v1</td></tr><tr><td style="text-align:left;">export</td><td style="text-align:left;">将容器文件系统作为一个tar归档文件导出到STDOUT</td><td style="text-align:left;">docker export [OPTIONS] CONTAINER</td><td style="text-align:left;">docker export -o hello-world.tar b2712f1067a3</td></tr><tr><td style="text-align:left;">import</td><td style="text-align:left;">导入容器快照文件系统tar归档文件并创建镜像</td><td style="text-align:left;">docker import [OPTIONS] file/URL/- [REPOSITORY[:TAG]]</td><td style="text-align:left;">docker import hello-world.tar</td></tr><tr><td style="text-align:left;">save</td><td style="text-align:left;">将指定镜像保存成<code>tar</code>文件</td><td style="text-align:left;">docker save [OPTIONS] IMAGE [IMAGE...]</td><td style="text-align:left;">docker save -o hello-world.tar hello-world:latest</td></tr><tr><td style="text-align:left;">load</td><td style="text-align:left;">加载tar文件并创建镜像</td><td style="text-align:left;"></td><td style="text-align:left;">docker load -i hello-world.tar</td></tr><tr><td style="text-align:left;">build</td><td style="text-align:left;">根据Dockerfile构建镜像</td><td style="text-align:left;">docker build [OPTIONS] PATH / URL / -</td><td style="text-align:left;">docker build -t zf/ubuntu:v1 .</td></tr></tbody></table><h2 id="容器container" tabindex="-1">容器container <a class="header-anchor" href="#容器container" aria-hidden="true">#</a></h2><ul><li><code>docker run</code> 命令会从 <code>image</code> 文件，生成一个正在运行的容器实例。</li><li><code>docker container run</code>命令具有自动抓取 image 文件的功能。如果发现本地没有指定的 image 文件，就会从仓库自动抓取</li><li>输出提示以后，hello world就会停止运行，容器自动终止。</li><li>有些容器不会自动终止</li><li>image 文件生成的容器实例，本身也是一个文件，称为容器文件</li><li>容器生成，就会同时存在两个文件： image 文件和容器文件</li><li>关闭容器并不会删除容器文件，只是容器停止运行</li></ul><h3 id="container-命令" tabindex="-1">container 命令 <a class="header-anchor" href="#container-命令" aria-hidden="true">#</a></h3><table><thead><tr><th>run</th><th>从镜像运行一个容器</th><th>docker run ubuntu /bin/echo &#39;hello-world&#39;</th></tr></thead><tbody><tr><td>ls</td><td>列出容器</td><td>docker container ls</td></tr><tr><td>inspect</td><td>显示一个或多个容器详细信息</td><td>docker inspect</td></tr><tr><td>attach</td><td>要attach上去的容器必须正在运行，可以同时连接上同一个container来共享屏幕</td><td>docker attach [OPTIONS] CONTAINER<br>docker attach 6d1a25f95132</td></tr><tr><td>stats</td><td>显示容器资源使用统计</td><td>docker container stats</td></tr><tr><td>top</td><td>停止一个容器运行的进程</td><td>docker container top</td></tr><tr><td>update</td><td>更新一个或多个容器配置</td><td>docker update -m 500m --memory-swap -1 6d1a25f95132</td></tr><tr><td>port</td><td>列出指定的容器的端口映射</td><td>docker run -d -p 8080:80 nginx docker container port containerID</td></tr><tr><td>ps</td><td>查看当前运行的容器</td><td>docker ps -a -l</td></tr><tr><td>kill [containerId]</td><td>终止容器(发送SIGKILL )</td><td>docker kill [containerId]</td></tr><tr><td>rm [containerId]</td><td>删除容器</td><td>docker rm [containerId]</td></tr><tr><td>start [containerId]</td><td>启动已经生成、已经停止运行的容器文件</td><td>docker start [containerId]</td></tr><tr><td>stop [containerId]</td><td>终止容器运行 (发送 SIGTERM )</td><td>docker stop [containerId] docker container stop $(docker container ps -aq)</td></tr><tr><td>logs [containerId]</td><td>查看 docker 容器的输出</td><td>docker logs [containerId]</td></tr><tr><td>exec [containerId]</td><td>进入一个正在运行的 docker 容器执行命令</td><td>docker container exec -it f6a53629488b /bin/bash</td></tr><tr><td>cp [containerId]</td><td>从正在运行的 Docker 容器里面，将文件拷贝到本机</td><td>docker container cp f6a53629488b:/root/root.txt .</td></tr><tr><td>commit [containerId]</td><td>根据一个现有容器创建一个新的镜像</td><td>docker commit -a &quot;zhufeng&quot; -m &quot;mynginx&quot; a404c6c174a2 mynginx:v1</td></tr></tbody></table><p>docker容器的主线程（dockfile中CMD执行的命令）结束，容器会退出</p><ul><li>以使用交互式启动 <code>docker run -i [CONTAINER_NAME or CONTAINER_ID]</code></li><li>tty选项 <code>docker run -dit [CONTAINER_NAME or CONTAINER_ID]</code></li><li>守护态（Daemonized）形式运行 <code>docker run -d ubuntu /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;</code></li></ul><h3 id="启动容器" tabindex="-1">启动容器 <a class="header-anchor" href="#启动容器" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello world</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><ul><li>docker: Docker 的二进制执行文件。</li><li>run:与前面的 docker 组合来运行一个容器。</li><li>ubuntu指定要运行的镜像，Docker首先从本地主机上查找镜像是否存在，如果不存在，Docker 就会从镜像仓库 Docker Hub 下载公共镜像。</li><li>/bin/echo &quot;Hello world&quot;: 在启动的容器里执行的命令</li></ul><blockquote><p>Docker以ubuntu镜像创建一个新容器，然后在容器里执行 bin/echo &quot;Hello world&quot;，然后输出结果</p><ul><li>Docker attach必须是登陆到一个已经运行的容器里。需要注意的是如果从这个容器中exit退出的话，就会导致容器停止</li></ul></blockquote><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">含义</th></tr></thead><tbody><tr><td style="text-align:left;">-i --interactive</td><td style="text-align:left;">交互式</td></tr><tr><td style="text-align:left;">-t --tty</td><td style="text-align:left;">分配一个伪终端</td></tr><tr><td style="text-align:left;">-d --detach</td><td style="text-align:left;">运行容器到后台</td></tr><tr><td style="text-align:left;">-a --attach list</td><td style="text-align:left;">附加到运行的容器</td></tr><tr><td style="text-align:left;">-e --env list</td><td style="text-align:left;">设置环境变量</td></tr><tr><td style="text-align:left;">-p --publish list</td><td style="text-align:left;">发布容器端口到主机</td></tr><tr><td style="text-align:left;">-P</td><td style="text-align:left;">--publish-all</td></tr></tbody></table><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1010</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">username=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">zhufeng</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> \\ </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">container</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">3695dc5b9c2d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-test</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"></span></code></pre></div><p>--name 容器名称</p><h4 id="进入一个正在运行的容器" tabindex="-1">进入一个正在运行的容器 <a class="header-anchor" href="#进入一个正在运行的容器" aria-hidden="true">#</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">container</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">containerID</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span></code></pre></div><h4 id="容器的端口映射" tabindex="-1">容器的端口映射 <a class="header-anchor" href="#容器的端口映射" aria-hidden="true">#</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8080</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><h3 id="容器制作个性化image" tabindex="-1">容器制作个性化image <a class="header-anchor" href="#容器制作个性化image" aria-hidden="true">#</a></h3><ul><li>docker commit :从容器创建一个新的镜像。</li><li>docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]] <ul><li>-a :提交的镜像作者</li><li>-c :使用Dockerfile指令来创建镜像</li><li>-m :提交时的说明文字</li><li>-p :在commit时，将容器暂停</li></ul></li><li>停止容器后不会自动删除这个容器，除非在启动容器的时候指定了 --rm 标志</li><li>使用 docker ps -a 命令查看 Docker 主机上包含停止的容器在内的所有容器</li><li>停止状态的容器的可写层仍然占用磁盘空间。要清理可以使用 <code>docker container prune</code> 命令</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">container</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">commit</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">my-nginx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">zs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">3695dc5b9c2d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">zs/mynginx:v1</span></span>
<span class="line"></span></code></pre></div><h2 id="dockerfile文件" tabindex="-1">Dockerfile文件 <a class="header-anchor" href="#dockerfile文件" aria-hidden="true">#</a></h2><ul><li>Docker 的镜像是用一层一层的文件组成的</li><li><code>docker inspect</code>命令可以查看镜像或者容器</li><li>Layers就是镜像的层文件，只读不能修改。基于镜像创建的容器会共享这些文件层</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">inspect</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"></span></code></pre></div><h3 id="指令" tabindex="-1">指令 <a class="header-anchor" href="#指令" aria-hidden="true">#</a></h3><table><thead><tr><th style="text-align:left;">指令</th><th style="text-align:left;">含义</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">FROM</td><td style="text-align:left;">构建的新镜像是基于哪个镜像</td><td style="text-align:left;">FROM centos:6</td></tr><tr><td style="text-align:left;">MAINTAINER</td><td style="text-align:left;">镜像维护者姓名或邮箱地址</td><td style="text-align:left;">MAINTAINER zhufengjiagou</td></tr><tr><td style="text-align:left;">RUN</td><td style="text-align:left;">构建镜像时运行的shell命令</td><td style="text-align:left;">RUN yum install httpd</td></tr><tr><td style="text-align:left;">CMD</td><td style="text-align:left;">CMD 设置容器启动后默认执行的命令及其参数，但 CMD 能够被 docker run 后面跟的命令行参数替换</td><td style="text-align:left;">CMD /usr/sbin/sshd -D</td></tr><tr><td style="text-align:left;">EXPOSE</td><td style="text-align:left;">声明容器运行的服务器端口</td><td style="text-align:left;">EXPOSE 80 443</td></tr><tr><td style="text-align:left;">ENV</td><td style="text-align:left;">设置容器内的环境变量</td><td style="text-align:left;">ENV MYSQL_ROOT_PASSWORD 123456</td></tr><tr><td style="text-align:left;">ADD</td><td style="text-align:left;">拷贝文件或目录到镜像中，如果是URL或者压缩包会自动下载和解压</td><td style="text-align:left;">ADD ,ADD <a href="https://xxx.com/html.tar.gz" target="_blank" rel="noreferrer">https://xxx.com/html.tar.gz</a> /var/<a href="http://www.html/" target="_blank" rel="noreferrer">www.html</a>, ADD html.tar.gz /var/www/html</td></tr><tr><td style="text-align:left;">COPY</td><td style="text-align:left;">拷贝文件或目录到镜像</td><td style="text-align:left;">COPY ./start.sh /start.sh</td></tr><tr><td style="text-align:left;">ENTRYPOINT</td><td style="text-align:left;">配置容器启动时运行的命令</td><td style="text-align:left;">ENTRYPOINT /bin/bash -c &#39;/start.sh&#39;</td></tr><tr><td style="text-align:left;">VOLUME</td><td style="text-align:left;">指定容器挂载点到宿主自动生成的目录或其它容器</td><td style="text-align:left;">VOLUME [&quot;/var/lib/mysql&quot;]</td></tr><tr><td style="text-align:left;">USER</td><td style="text-align:left;">为 RUN CMD和ENTRYPOINT执行命令指定运行用户</td><td style="text-align:left;">USER zhufengjiagou</td></tr><tr><td style="text-align:left;">WORKDIR</td><td style="text-align:left;">为RUN CMD ENTRYPOINT COPY ADD 设置工作目录</td><td style="text-align:left;">WORKDIR /data</td></tr><tr><td style="text-align:left;">HEALTHCHECK</td><td style="text-align:left;">健康检查</td><td style="text-align:left;">HEALTHCHECK --interval=5m --timeout=3s --retries=3 CMS curl -f htp://localhost</td></tr><tr><td style="text-align:left;">ARG</td><td style="text-align:left;">在构建镜像时指定一些参数</td><td style="text-align:left;">ARG user</td></tr></tbody></table><h3 id="dockerignore-表示要排除-不要打包到image中的文件路径" tabindex="-1">.dockerignore 表示要排除，不要打包到image中的文件路径 <a class="header-anchor" href="#dockerignore-表示要排除-不要打包到image中的文件路径" aria-hidden="true">#</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">.git</span></span>
<span class="line"><span style="color:#FFCB6B;">node_modules</span></span>
<span class="line"></span></code></pre></div><p>dockerfile</p><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">FROM node</span></span>
<span class="line"><span style="color:#A6ACCD;">COPY ./app /app</span></span>
<span class="line"><span style="color:#A6ACCD;">WORKDIR /app</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN npm install</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPOSE 3000</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>创建image</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">express-demo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"></span></code></pre></div><ul><li>-t用来指定image镜像的名称，后面还可以加冒号指定标签，如果不指定默认就是latest</li><li><code>.</code> 表示Dockerfile文件的所有路径,<code>.</code>就表示当前路径</li></ul><p>运行生成容器并在后台运行</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">container</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3333</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">express-demo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"></span></code></pre></div><h4 id="cmd指令" tabindex="-1">cmd指令 <a class="header-anchor" href="#cmd指令" aria-hidden="true">#</a></h4><p>dockefile</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node:15.10.0-slim</span></span>
<span class="line"><span style="color:#FFCB6B;">COPY</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./app</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/app</span></span>
<span class="line"><span style="color:#FFCB6B;">WORKDIR</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/app</span></span>
<span class="line"><span style="color:#FFCB6B;">USER</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">root</span></span>
<span class="line"><span style="color:#FFCB6B;">RUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">--registry=https://registry.npm.taobao.org</span></span>
<span class="line"><span style="color:#FFCB6B;">EXPOSE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3000</span></span>
<span class="line"><span style="color:#FFCB6B;">CMD</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"></span></code></pre></div><p>重新制作做镜像并运行容器</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">express-demo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">container</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3333</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">express-demo</span></span>
<span class="line"></span></code></pre></div><ul><li>RUN命令在 image 文件的构建阶段执行，执行结果都会打包进入 image 文件；CMD命令则是在容器启动后执行</li><li>一个 Dockerfile 可以包含多个RUN命令，但是只能有一个CMD命令</li><li>指定了CMD命令以后，docker container run命令就不能附加命令了（比如前面的/bin/bash），否则它会覆盖CMD命令</li></ul><h2 id="数据卷volume" tabindex="-1">数据卷volume <a class="header-anchor" href="#数据卷volume" aria-hidden="true">#</a></h2><p>删除容器的时候，容器层里创建的文件也会被删除掉，如果有些数据你想永久保存，比如Web服务器的日志，数据库管理系统中的数据，可以为容器创建一个数据盘</p><img src="`+o+`" alt="image-20230315143429170" style="zoom:50%;"><ul><li>volumes Docker管理宿主机文件系统的一部分(/var/lib/docker/volumes)</li><li>如果没有指定卷，则会自动创建</li><li>建议使用--mount ,更通用</li></ul><h2 id="网络设置" tabindex="-1">网络设置 <a class="header-anchor" href="#网络设置" aria-hidden="true">#</a></h2><ul><li>安装Docker时，它会自动创建三个网络，bridge（创建容器默认连接到此网络）、 none 、host <ul><li>None：该模式关闭了容器的网络功能,对外界完全隔离</li><li>host：容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。</li><li>bridge 桥接网络，此模式会为每一个容器分配IP</li></ul></li><li>可以使用该<code>--network</code>标志来指定容器应连接到哪些网络</li></ul><h2 id="compose" tabindex="-1">compose <a class="header-anchor" href="#compose" aria-hidden="true">#</a></h2><ul><li>Compose 通过一个配置文件来管理多个Docker容器</li><li>在配置文件中，所有的容器通过services来定义，然后使用docker-compose脚本来启动、停止和重启应用和应用中的服务以及所有依赖服务的容器</li><li>步骤： <ul><li>最后，运行<code>docker-compose up</code>，Compose 将启动并运行整个应用程序 配置文件组成</li><li>services 可以定义需要的服务，每个服务都有自己的名字、使用的镜像、挂载的数据卷所属的网络和依赖的其它服务</li><li>networks 是应用的网络，在它下面可以定义使用的网络名称，类性</li><li>volumes是数据卷，可以在此定义数据卷，然后挂载到不同的服务上面使用</li></ul></li></ul><p>安装</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">epel-release</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">python-pip</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clean</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span></span>
<span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-compose</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 设置权限</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://get.daocloud.io/docker/compose/releases/download/v2.</span><span style="color:#F78C6C;">5.0</span><span style="color:#C3E88D;">/docker-compose-</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">uname</span><span style="color:#C3E88D;"> -s</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">-</span><span style="color:#89DDFF;">\`</span><span style="color:#FFCB6B;">uname</span><span style="color:#C3E88D;"> -m</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">/usr/local/bin/docker-compose</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/usr/local/bin/docker-compose</span></span>
<span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--version</span></span>
<span class="line"></span></code></pre></div><p>docker-compose.yml文件</p><ul><li>在 <code>docker-compose.yml</code> 中定义组成应用程序的服务，以便它们可以在隔离的环境中一起运行</li><li>空格缩进表示层次</li><li>冒号空格后面有空格</li></ul><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nginx1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8080:80</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nginx2</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8081:80</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span>
<span class="line"></span></code></pre></div><h3 id="启动命令" tabindex="-1">启动命令 <a class="header-anchor" href="#启动命令" aria-hidden="true">#</a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">服务</th></tr></thead><tbody><tr><td style="text-align:left;">docker-compose up</td><td style="text-align:left;">启动所有的服务</td></tr><tr><td style="text-align:left;">docker-compose up -d</td><td style="text-align:left;">后台启动所有的服务</td></tr><tr><td style="text-align:left;">docker-compose ps</td><td style="text-align:left;">打印所有的容器</td></tr><tr><td style="text-align:left;">docker-compose stop</td><td style="text-align:left;">停止所有服务</td></tr><tr><td style="text-align:left;">docker-compose logs -f</td><td style="text-align:left;">持续跟踪日志</td></tr><tr><td style="text-align:left;">docker-compose exec nginx1 bash</td><td style="text-align:left;">进入nginx1服务系统</td></tr><tr><td style="text-align:left;">docker-compose rm nginx1</td><td style="text-align:left;">删除服务容器</td></tr><tr><td style="text-align:left;">docker network ls</td><td style="text-align:left;">查看网络网络不会删除</td></tr><tr><td style="text-align:left;">docker-compose down</td><td style="text-align:left;">删除所有的网络和容器</td></tr></tbody></table><blockquote><p>删除所有的容器 docker container rm <code>docker container ps -a -q</code></p></blockquote><h3 id="compose-配置数据卷volume" tabindex="-1">compose 配置数据卷volume <a class="header-anchor" href="#compose-配置数据卷volume" aria-hidden="true">#</a></h3><ul><li>networks 指定自定义网络</li><li>volumes 指定数据卷</li><li>数据卷在宿主机的位置 <code>/var/lib/docker/volumes/nginx-compose_data/_data</code></li></ul><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">3</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nginx1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8081:80</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">networks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">newweb</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">data:/data</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./nginx1:/usr/share/nginx/html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#容器与系统文件会同步</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nginx2</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8082:80</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">networks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">data:/data</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./nginx2:/usr/share/nginx/html</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">nginx3</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8083:80</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">networks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">newweb</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">data:/data</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./nginx3:/usr/share/nginx/html</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">networks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">newweb</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">driver</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bridge</span></span>
<span class="line"><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">driver</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span></span>
<span class="line"></span></code></pre></div><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-itd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nginx-compose_nginx1_1</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">touch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">1.txt</span></span>
<span class="line"><span style="color:#82AAFF;">exit</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/lib/docker/volumes/nginx-compose_data/_data</span></span>
<span class="line"><span style="color:#FFCB6B;">ls</span></span>
<span class="line"></span></code></pre></div><h2 id="docker-compose-搭建node项目" tabindex="-1">docker compose 搭建node项目 <a class="header-anchor" href="#docker-compose-搭建node项目" aria-hidden="true">#</a></h2><div class="language-dockerfile"><button title="Copy Code" class="copy"></button><span class="lang">dockerfile</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">version: &#39;2&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">services:</span></span>
<span class="line"><span style="color:#A6ACCD;"> node:</span></span>
<span class="line"><span style="color:#A6ACCD;">  build:</span></span>
<span class="line"><span style="color:#A6ACCD;">    context: ./images/node</span></span>
<span class="line"><span style="color:#A6ACCD;">    dockerfile: Dockerfile</span></span>
<span class="line"><span style="color:#A6ACCD;">  depends_on:</span></span>
<span class="line"><span style="color:#A6ACCD;">   - db</span></span>
<span class="line"><span style="color:#A6ACCD;"> web:</span></span>
<span class="line"><span style="color:#A6ACCD;">  image: nginx</span></span>
<span class="line"><span style="color:#A6ACCD;">  ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">   - &quot;8080:80&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">   - ./images/nginx/config:/etc/nginx/conf.d</span></span>
<span class="line"><span style="color:#A6ACCD;">   - ./images/node/web/public:/public  </span></span>
<span class="line"><span style="color:#A6ACCD;">  depends_on:</span></span>
<span class="line"><span style="color:#A6ACCD;">   - node</span></span>
<span class="line"><span style="color:#A6ACCD;"> db:</span></span>
<span class="line"><span style="color:#A6ACCD;">  image: mariadb</span></span>
<span class="line"><span style="color:#A6ACCD;">  environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">   MYSQL_ROOT_PASSWORD: &quot;root&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">   MYSQL_DATABASE: &quot;node&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">   MYSQL_USER: &quot;zfpx&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">   MYSQL_PASSWORD: &quot;123456&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">    - db:/var/lib/mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;"> db:</span></span>
<span class="line"><span style="color:#A6ACCD;">  driver: local</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div>`,83),r=[c];function i(d,y,C,D,A,g){return a(),l("div",null,r)}const F=s(p,[["render",i]]);export{u as __pageData,F as default};
